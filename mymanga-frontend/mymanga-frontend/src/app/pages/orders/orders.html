<div class="container my-5">
  <div class="orders-container">
    <h1 class="mb-4">Meus Pedidos</h1>

    @if (loading) {
      <div class="alert alert-info">Carregando seus pedidos...</div>
    }

    @if (successMessage) {
      <div class="alert alert-success">{{ successMessage }}</div>
    }

    @if (errorMessage) {
      <div class="alert alert-danger">{{ errorMessage }}</div>
    }

    @if (!loading && orders.length === 0 && !errorMessage) {
      <div class="text-center py-5">
        <div style="font-size: 3rem; opacity: 0.6;">üõçÔ∏è</div>
        <p class="lead mt-3">Voc√™ ainda n√£o fez nenhum pedido.</p>
        <a class="btn btn-primary mt-3" routerLink="/">
          Come√ßar a Comprar
        </a>
      </div>
    }

    @if (!loading && orders.length > 0) {
      <div class="accordion" id="ordersAccordion">
        @for (order of orders; track order.id) {
          <div class="accordion-item">
            <h2 class="accordion-header" [id]="'heading' + order.id">
              <button class="accordion-button collapsed" type="button" 
                      data-bs-toggle="collapse" 
                      [attr.data-bs-target]="'#collapse' + order.id" 
                      aria-expanded="false" 
                      [attr.aria-controls]="'collapse' + order.id">
                
                <div class="d-flex w-100 justify-content-between align-items-center pe-3">
                  <div>
                    <span class="fw-bold">Pedido #{{ order.id }}</span>
                    <span class="badge ms-2" [ngClass]="{
                      'bg-warning text-dark': order.status === 'WAITING_CONFIRMATION',
                      'bg-info text-dark': order.status === 'CONFIRMED',
                      'bg-primary': order.status === 'SHIPPED',
                      'bg-success': order.status === 'DELIVERED',
                      'bg-danger': order.status === 'CANCELLED'
                    }">{{ order.status }}</span>
                  </div>
                  <div class="text-end">
                    <div class="text-muted small">{{ formatDate(order.createdAt) }}</div>
                    <div class="fw-bold">{{ order.finalPrice | currency:'BRL' }}</div>
                  </div>
                </div>
              </button>
            </h2>
            <div [id]="'collapse' + order.id" 
                 class="accordion-collapse collapse" 
                 [attr.aria-labelledby]="'heading' + order.id"
                 data-bs-parent="#ordersAccordion">
              <div class="accordion-body">
                <div class="mb-4">
                  <p><strong>M√©todo de Pagamento:</strong> {{ order.paymentMethod }}</p>
                  <p><strong>Total de Itens:</strong> {{ getTotalItems(order) }}</p>
                  @if (order.createdAt) {
                    <p><strong>Data do Pedido:</strong> {{ formatDate(order.createdAt) }}</p>
                  }
                </div>

                <h5 class="mb-3">Itens do Pedido</h5>
                <div class="row g-3 mb-4">
                  @for (item of order.items; track item.mangaTitle + item.volumeNumber) {
                    <div class="col-12 col-md-6">
                      <div class="card h-100">
                        <div class="card-body">
                          <div class="d-flex justify-content-between">
                            <div>
                              <h6 class="card-title mb-1">{{ item.mangaTitle }}</h6>
                              <p class="text-muted mb-1">Volume {{ item.volumeNumber }}</p>
                              <p class="mb-0">Quantidade: {{ item.quantity || 1 }}</p>
                            </div>
                            <div class="text-end">
                              <p class="fw-bold mb-0">{{ item.unitPrice | currency:'BRL' }}</p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  }
                </div>

                <div class="text-end mt-3">
                  <button *ngIf="order.status === 'CONFIRMED' || order.status === 'WAITING_CONFIRMATION'" 
                          (click)="cancelarPedido(order.id)" 
                          class="btn btn-danger btn-sm"
                          [disabled]="loading">
                    <i class="bi bi-x-circle"></i> Cancelar Pedido
                  </button>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
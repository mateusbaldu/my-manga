<div class="container mt-5 mb-5">
  <h1 class="mb-4 display-4">Todos os Mangás</h1>

  <form (ngSubmit)="searchMangas()" class="row g-3 mb-4">
    <div class="col-9">
      <input type="text" class="form-control" placeholder="Buscar por título ou palavra-chave..." 
             [(ngModel)]="searchTerm" name="searchTerm">
    </div>
    <div class="col-3">
      <button type="submit" class="btn btn-primary w-100">Buscar</button>
    </div>
  </form>

  @if (isSearching && !loading) {
    <h4 class="mb-3">Resultados para: "{{ searchTerm }}"</h4>
  }

  <div *ngIf="loading" class="alert alert-info text-center">
    Carregando mangás...
  </div>

  <div *ngIf="error" class="alert alert-danger text-center">
    {{ error }}
  </div>

  <div class="d-flex justify-content-end mb-3">
    <button class="btn btn-outline-warning" (click)="ordenarPorNota()">
      <i class="bi bi-star-fill me-2"></i>
      <span *ngIf="currentSort === 'rating,desc'">Ver Padrão</span>
      <span *ngIf="currentSort !== 'rating,desc'">Melhores Avaliados</span>
    </button>
  </div>

  <div class="row g-4">
    <div class="col-12 col-sm-6 col-lg-3 mb-4" *ngFor="let manga of mangas; trackBy: trackByMangaId">
      <div class="card h-100" [routerLink]="['/manga', manga.id]" style="cursor: pointer;">
        <div class="position-relative">
          <img [src]="manga.imageUrl" class="card-img-top" [alt]="manga.title" *ngIf="manga.imageUrl" style="height: 300px; object-fit: cover;">
          
          <span class="position-absolute top-0 end-0 badge bg-dark text-warning m-2 fs-6 opacity-75">
            <i class="bi bi-star-fill"></i> {{ manga.rating }}
          </span>
        </div>
        
        <div class="card-body">
          <h4 class="card-title">{{ manga.title }}</h4>
          <h6 class="card-subtitle mb-2 text-muted">{{ manga.author }}</h6>
          <p class="card-text" *ngIf="manga.description">{{ manga.description }}</p>
        </div>
        
        <div class="card-footer">
          <button class="btn btn-primary w-100">
            Ver Detalhes
          </button>
        </div>
      </div>
    </div>
  </div>

  @if (!loading && totalPages > 1) {
    <div class="d-flex justify-content-center align-items-center mt-4">
      <button class="btn btn-primary" (click)="prevPage()" [disabled]="page === 0">
        Anterior
      </button>
      <span class="mx-3">
        Página {{ page + 1 }} de {{ totalPages }}
      </span>
      <button class="btn btn-primary" (click)="nextPage()" [disabled]="page >= totalPages - 1">
        Próxima
      </button>
    </div>
  }
</div>
